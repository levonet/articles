# Капитанские советы БЭМ

Не программист и не фронтендер, но захотелось попробовать написать свой проект,
используя БЭМ. В процессе собрался набор очевидных рекомендаций, которые по началу
казались вовсе не очевидными.
Надеюсь, они помогут новичкам быстро сориентироваться, что к чему.

    «Нужно писать код правильно, не писать не правильно.»
    © veged@

`<cut>`

1. Если код элемента или модификатора описывается несколькими строками, то можно его держать в
родительской сущности, например в блоке. Это делает код более читаемым. При разрастании кода,
выносим в [отдельные файлы](https://ru.bem.info/method/filesystem/#Опциональные-элементы-и-модификаторы-выносятся-в-отдельные-файлы),
соответствующей сущности.

2. Очень удобно сначала писать BEMJSON, а потом начинать на него писать шаблоны. Потому, что
шаблонизатор BEMHTML предполагает поведение по умолчанию. Если написать BEMJSON

    ```JS
    {
        block: 'block1',
        content: [
            {
                elem: 'elem1',
                content: 'Bla bla bla'
            }
        ]
    }
    ```

    и не написать никаких шаблонов, то в результате сгенерируется вот такой HTML:

    ```HTML
    <div class="block1"><div class="block1__elem1">Bla bla bla</div></div>
    ```

3. Везде, где необходимо ..., в блоке указываем в шаблоне блока `js()(true)`,
это включит в HTML-теге атрибут `data-bem`, что будет означать, ...

4. Всё, что вынесли в отдельный файл блока, элемента или модификатора подключаем в
файле (`*.deps.js`) той сущности, где используем. По началу, часто забываешь.
Если какая-то [БЭМ-сущность](https://ru.bem.info/method/definitions/#БЭМ-сущность)
более не используется в блоке, нужно не забыть убрать её из депсов, это ускорит сборку
и немного уменьшит уезжающий код на клиента.

5. Везде, где используем ... в `*.deps.js` БЭМ-сущности добавляем зависимость от `i-bem`, это ...

6. Для CSS, если возникла необходимость модифицировать какой-то один блок
(или другую БЭМ-сущность), то лучше это сделать
[булевым модификатором](https://ru.bem.info/method/naming-convention/#Имя-модификатора).
Если такая, однотипная модификация, требуется для нескольких различных блоков,
то лучше её вынести в блок и [подключать миксом](https://ru.bem.info/technology/bemjson/v2/bemjson/#Представление-БЭМ-сущностей).

7. Инициализацию и функциональность элемента или модификатора выносим в отдельный
файл (или объявление) элемента или модификатора. Это делает блок независимым от кода
данной сущности. Немного про [декларацию в JS](https://ru.bem.info/libs/bem-core/v2.6.0/desktop/i-bem/docs/#Декларация).

    ```JS
    modules.define('block1', ['i-bem__dom'], function(provide, BEMDOM) {
    provide(BEMDOM.decl(this.name, {}, {}));
    });

    modules.define('block1', ['i-bem__dom'], function(provide, BEMDOM, Block1) {
    provide(Block1.decl({block: 'block1', elem: 'elem1'}, {
        onSetMod : {
            'js' : {
                'inited' : function() {
                        this.__base.apply(this, arguments);
                        ...
                    });
                }
            }
        }
    }))
    
    });
    ```

8. Поиск BEMDOM одного из нескольких одноименных блоков внутри родительского блока
с помощью обёртки в элемент. Иногда нужно навесить БЭМ-событие на один из нескольких блоков
(например `link`) внутри родительского блока. Самый простой способ, обернуть нужный блок
элементом и найти его BEMDOM методом [findBlockInside([elem], block)](https://ru.bem.info/libs/bem-core/v2.6.0/desktop/i-bem/jsdoc/#findBlockInside-1).

    ```JS
    var link = this.findBlockInside('elem1', 'link');
    ```

9. Иногда возникает необходимость быстро обернуть элемент другим элементом.
Для этого можно воспользоваться модой [default](https://ru.bem.info/technology/bemhtml/v2/reference/#default)
и методом [applyCtx](https://ru.bem.info/technology/bemhtml/v2/templating/#applyctx)
для модификации контента, перед тем, как применится шаблон элемента (или другой БЭМ-сущности).

    Элемент `image` в шаблоне блока

    ```JS
    block('block1')(
        ...
        elem('image')(
            tag()('img'),
            attrs()(function() { return { src: this.ctx.url }; })
        )
    );
    ```

    оборачиваем тэгом `<span>` с помощью элемента `wrapper`

    ```JS
    block('block1')(
        ...
        elem('image')(
            def()(function(){ applyCtx([{ elem: 'wrapper', content: this.ctx }]); }),
            tag()('img'),
            attrs()(function() { return { src: this.ctx.url }; })
        )
    );
    block('block1').elem('wrapper').tag('span');
    ```

    Но так лучше не оставлять, а отрефакторить при первой же возможности.

10. Чтобы в блоке (или другой БЭМ-сущности) расположить последовательно несколько
других элементов или блоков, нужно их передать в `content()` с помощью функции в формате BEMJSON:

    ```JS
    block('blok1')(
        ...
        content()(function() {
            return [
                { elem: 'elem1', content: 'BOO' },
                { block: 'block2', content: 'FOO' }
            ]
        })
    );
    ```

    Это же свойство можно использовать для создания более сложной HTML-структуры блока:

    ```JS
        content()(function() {
            return [
                {
                    elem: 'elem1',
                    content: [
                        { elem: 'elem2', content: 'Bla' }
                        { block: 'block3', content: 'Bla Bla' },
                        'BOO'
                    ]
                },
                { block: 'block2', content: 'FOO' }
            ]
        })
    ```

11. Чтобы вложить в элемент другой элемент (или другую БЭМ-сущность), можно воспользоваться
предыдущим советом, с отличаем, что для проброса содержимого элемента нужно использовать
[applyNext()](https://ru.bem.info/technology/bemhtml/v2/templating/#applynext):

    ```JS
    block('block1').elem('elem1')(
        ...
        content()(function(){
            return {
                elem: 'elem2',
                content: applyNext()
            };
        }),
    );
    ```

12. Очень удобно использовать [произвольные поля](https://ru.bem.info/technology/bemjson/v2/bemjson/#Произвольные-поля)
в сочетании с [произвольными условиями](https://ru.bem.info/technology/bemhtml/v2/templating/#Произвольное-условие).
Это позволяет [шаблонизировать на клиенте](https://ru.bem.info/forum/476/) данные, максимально приближенные к JSON.

Предлагаю накапливать капитанские советы, пишите в комментариях, будем расширять список.
